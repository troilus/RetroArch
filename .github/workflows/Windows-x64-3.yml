name: CI Windows x64 (MXE)  
  
on:  
  push:  
    branches: [main]  # 只在主分支触发  
  workflow_dispatch:  # 手动触发  
  
permissions:  
  contents: write  # 需要写入权限  
  
jobs:  
  build:  
    runs-on: ubuntu-latest  
    container:  
      image: git.libretro.com:5050/libretro-infrastructure/libretro-build-mxe-win64-cross:latest  
      options: --user root  
      
    steps:  
    - uses: taiki-e/checkout-action@v1  
      with:  
        token: ${{ secrets.GITHUB_TOKEN }}  # 需要token才能推送  
  
    - name: Compile RA  
      run: |  
        export MOC=/usr/lib/mxe/usr/x86_64-w64-mingw32.shared/qt5/bin/moc  
        ./configure --host=x86_64-w64-mingw32.shared  
        make clean  
        make -j$(getconf _NPROCESSORS_ONLN)  
  
    - name: Commit and push binary  
      run: |  
        git config --local user.email "action@github.com"  
        git config --local user.name "GitHub Action"  
        mkdir -p builds/windows-x64  
        cp retroarch.exe builds/windows-x64/  
        git add builds/windows-x64/retroarch.exe  
        git commit -m "Auto-update Windows x64 build" || exit 0  
        git push